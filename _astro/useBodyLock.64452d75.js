import{r as e}from"./index.03be2d59.js";import{u as I,f as F,a as $,P as S,L as U}from"./motion.86f98872.js";function P(){const t=e.useRef(!1);return I(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function A(){const t=P(),[o,n]=e.useState(0),r=e.useCallback(()=>{t.current&&n(o+1)},[o]);return[e.useCallback(()=>F.postRender(r),[r]),o]}class B extends e.Component{getSnapshotBeforeUpdate(o){const n=this.props.childRef.current;if(n&&o.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function K({children:t,isPresent:o}){const n=e.useId(),r=e.useRef(null),p=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:l,height:d,top:f,left:h}=p.current;if(o||!r.current||!l||!d)return;r.current.dataset.motionPopId=n;const a=document.createElement("style");return document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${d}px !important;
            top: ${f}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[o]),e.createElement(B,{isPresent:o,childRef:r,sizeRef:p},e.cloneElement(t,{ref:r}))}const w=({children:t,initial:o,isPresent:n,onExitComplete:r,custom:p,presenceAffectsLayout:l,mode:d})=>{const f=$(O),h=e.useId(),a=e.useMemo(()=>({id:h,initial:o,isPresent:n,custom:p,onExitComplete:s=>{f.set(s,!0);for(const c of f.values())if(!c)return;r&&r()},register:s=>(f.set(s,!1),()=>f.delete(s))}),l?void 0:[n]);return e.useMemo(()=>{f.forEach((s,c)=>f.set(c,!1))},[n]),e.useEffect(()=>{!n&&!f.size&&r&&r()},[n]),d==="popLayout"&&(t=e.createElement(K,{isPresent:n},t)),e.createElement(S.Provider,{value:a},t)};function O(){return new Map}function T(t){return e.useEffect(()=>()=>t(),[])}const m=t=>t.key||"";function D(t,o){t.forEach(n=>{const r=m(n);o.set(r,n)})}function G(t){const o=[];return e.Children.forEach(t,n=>{e.isValidElement(n)&&o.push(n)}),o}const W=({children:t,custom:o,initial:n=!0,onExitComplete:r,exitBeforeEnter:p,presenceAffectsLayout:l=!0,mode:d="sync"})=>{const f=e.useContext(U).forceRender||A()[0],h=P(),a=G(t);let s=a;const c=e.useRef(new Map).current,C=e.useRef(s),E=e.useRef(new Map).current,R=e.useRef(!0);if(I(()=>{R.current=!1,D(a,E),C.current=s}),T(()=>{R.current=!0,E.clear(),c.clear()}),R.current)return e.createElement(e.Fragment,null,s.map(u=>e.createElement(w,{key:m(u),isPresent:!0,initial:n?void 0:!1,presenceAffectsLayout:l,mode:d},u)));s=[...s];const x=C.current.map(m),M=a.map(m),v=x.length;for(let u=0;u<v;u++){const i=x[u];M.indexOf(i)===-1&&!c.has(i)&&c.set(i,void 0)}return d==="wait"&&c.size&&(s=[]),c.forEach((u,i)=>{if(M.indexOf(i)!==-1)return;const g=E.get(i);if(!g)return;const z=x.indexOf(i);let y=u;if(!y){const L=()=>{E.delete(i),c.delete(i);const b=C.current.findIndex(k=>k.key===i);if(C.current.splice(b,1),!c.size){if(C.current=a,h.current===!1)return;f(),r&&r()}};y=e.createElement(w,{key:m(g),isPresent:!1,onExitComplete:L,custom:o,presenceAffectsLayout:l,mode:d},g),c.set(i,y)}s.splice(z,0,y)}),s=s.map(u=>{const i=u.key;return c.has(i)?u:e.createElement(w,{key:m(u),isPresent:!0,presenceAffectsLayout:l,mode:d},u)}),e.createElement(e.Fragment,null,c.size?s:s.map(u=>e.cloneElement(u)))};function _(t){e.useEffect(()=>{const o=window.getComputedStyle(document.body).overflow;return document.body.style.overflow=t?"hidden":o,()=>{document.body.style.overflow=o}},[t])}export{W as A,T as a,_ as u};
